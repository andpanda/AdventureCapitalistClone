{"code":"import { __extends } from \"tslib\";\r\nimport 'phaser';\r\nimport { StringFormatUtils } from '../com.andre.utils/StringFormatUtils';\r\nimport { PlayerData } from '../com.andre.data/PlayerData';\r\nvar Investment = /** @class */ (function (_super) {\r\n    __extends(Investment, _super);\r\n    function Investment(scene, id, x, y, iData) {\r\n        var _this = _super.call(this, scene, 'sprite') || this;\r\n        _this.iData = iData;\r\n        //this.investmentId = id;\r\n        if (_this.isEnabled) {\r\n            _this.DrawInvestment(scene, id, x, y);\r\n        }\r\n        else {\r\n            var frameBg_1 = scene.add.image(x + 122, y, 'inactive_investment');\r\n            frameBg_1.scale = 0.8;\r\n            var t1_1 = scene.add.text(frameBg_1.x, frameBg_1.y - 14, iData.investmentName).setOrigin(0.5, 0.5);\r\n            var t2_1 = scene.add.text(frameBg_1.x, frameBg_1.y + 14, StringFormatUtils.FormatMoney(iData.basePrice)).setOrigin(0.5, 0.5);\r\n            frameBg_1.setInteractive({ useHandCursor: true })\r\n                .on('pointerdown', function () {\r\n                _this.isEnabled = true;\r\n                _this.DrawInvestment(scene, id, x, y);\r\n                _this.OnPurchase(1);\r\n                frameBg_1.destroy();\r\n                t1_1.destroy();\r\n                t2_1.destroy();\r\n            });\r\n        }\r\n        return _this;\r\n    }\r\n    Investment.prototype.OnPurchase = function (quant) {\r\n        this.iData.own += quant;\r\n        this.ownLabel.text = '' + this.iData.own;\r\n    };\r\n    Investment.prototype.DrawInvestment = function (scene, id, x, y) {\r\n        var _this = this;\r\n        var investmentFrame = scene.add.image(x, y, 'investment-frame');\r\n        investmentFrame.scale = 0.55;\r\n        var logo = scene.add.image(investmentFrame.x, investmentFrame.y - 8, 'investment_logo_' + id);\r\n        logo.scale = 0.6;\r\n        this.ownLabel = scene.add.text(investmentFrame.x - 4, investmentFrame.y + 18, '' + this.iData.own);\r\n        investmentFrame.setInteractive({ useHandCursor: true })\r\n            .on('pointerdown', function () {\r\n            _this.RunInvestment();\r\n        });\r\n        var investmentProgressBg = scene.add.image(investmentFrame.x + 168, investmentFrame.y - 19, 'investment-progress-bg');\r\n        investmentProgressBg.scale = 0.75;\r\n        investmentProgressBg.setInteractive({ useHandCursor: true })\r\n            .on('pointerdown', function () {\r\n            _this.RunInvestment();\r\n        });\r\n        //bar used to display the investment progress\r\n        var greenBar = scene.add.image(investmentProgressBg.x - 116, investmentProgressBg.y, 'meter_green');\r\n        greenBar.scale = 0.65;\r\n        greenBar.setOrigin(1, 0.5);\r\n        greenBar.scaleX = 0;\r\n        this.progressBar = greenBar;\r\n        var mask = investmentProgressBg.createBitmapMask();\r\n        greenBar.setMask(mask);\r\n        var investmentBtn = scene.add.image(investmentFrame.x + 130, investmentFrame.y + 28, 'invest_btn');\r\n        investmentBtn.scaleX = 0.7;\r\n        investmentBtn.scaleY = 0.5;\r\n        investmentBtn.setInteractive({ useHandCursor: true })\r\n            .on('pointerover', function () { return console.log('oi'); })\r\n            .on('pointerout', function () { return console.log('oi2'); })\r\n            .on('pointerdown', function () {\r\n            investmentBtn.setTexture('invest_btn_pressed');\r\n            _this.OnPurchase(1);\r\n        })\r\n            .on('pointerup', function () { investmentBtn.setTexture('invest_btn'); });\r\n        var buyText = scene.add.text(investmentBtn.x - 63, investmentBtn.y - 20, 'Buy');\r\n        scene.add.text(buyText.x, buyText.y + 20, 'x1');\r\n        var bPrice = this.iData.basePrice;\r\n        var priceText = scene.add.text(buyText.x + 130, buyText.y, StringFormatUtils.FormatMoney(bPrice + (bPrice * this.iData.costIncrement) * this.iData.own));\r\n        priceText.setOrigin(1, 0);\r\n        var timerBtn = scene.add.image(investmentBtn.x + 126, investmentBtn.y, 'invest_btn_disabled');\r\n        timerBtn.scaleX = 0.42;\r\n        timerBtn.scaleY = 0.5;\r\n        this.timerText = scene.add.text(timerBtn.x, timerBtn.y, '00:00:00');\r\n        this.timerText.setOrigin(0.5, 0.5);\r\n    };\r\n    Investment.prototype.RunInvestment = function () {\r\n        if (this.iData.isRunning)\r\n            return;\r\n        this.iData.startTime = Date.now();\r\n        this.iData.endTime = this.iData.startTime + (this.iData.duration * 1000);\r\n        this.iData.isRunning = true;\r\n    };\r\n    Investment.prototype.update = function () {\r\n        if (this.iData.isRunning) {\r\n            var timeleft = this.iData.endTime - Date.now();\r\n            this.timerText.text = '' + timeleft;\r\n            var d = this.iData.duration * 1000;\r\n            var l = ((timeleft - d) / d);\r\n            console.log((l));\r\n            this.progressBar.scaleX = l;\r\n            if (timeleft <= 0) {\r\n                this.progressBar.scaleX = 0;\r\n                this.iData.isRunning = false;\r\n                this.timerText.text = '00:00:00';\r\n                PlayerData.money += this.iData.revenue * this.iData.own;\r\n                console.log(this.iData.revenue + ' / ' + this.iData.own);\r\n                console.log(PlayerData.money);\r\n                if (this.isManagerEnabled)\r\n                    this.RunInvestment();\r\n            }\r\n        }\r\n    };\r\n    return Investment;\r\n}(Phaser.GameObjects.GameObject));\r\nexport { Investment };\r\n","references":["/Applications/Projects/Phaser/node_modules/phaser/types/phaser.d.ts","/Applications/Projects/Phaser/node_modules/phaser/types/phaser.d.ts","/Applications/Projects/Phaser/src/com.andre.utils/StringFormatUtils.ts","/Applications/Projects/Phaser/src/com.andre.data/PlayerData.ts"]}
